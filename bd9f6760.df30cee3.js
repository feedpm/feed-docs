(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{130:function(e,t,r){"use strict";r.r(t),r.d(t,"frontMatter",(function(){return o})),r.d(t,"metadata",(function(){return c})),r.d(t,"toc",(function(){return l})),r.d(t,"default",(function(){return p}));var n=r(3),a=r(7),s=(r(0),r(158)),i=r(159),o={id:"persist-store",title:"Redux Persist",sidebar_label:"Redux Persist"},c={unversionedId:"react/training/persist-store",id:"react/training/persist-store",isDocsHomePage:!1,title:"Redux Persist",description:"Redux Persist takes your Redux state object and saves it to persisted storage. Then on app launch it retrieves this persisted state and saves it back to redux.",source:"@site/docs/react/training/persist-store.md",slug:"/react/training/persist-store",permalink:"/docs/react/training/persist-store",editUrl:"https://github.com/feedpm/feed-docs/tree/main/docs/react/training/persist-store.md",version:"current",sidebar_label:"Redux Persist",sidebar:"docs",previous:{title:"Store",permalink:"/docs/react/training/store-tutorial"},next:{title:"Components-Props-Communication",permalink:"/docs/react/training/components-props-communication"}},l=[{value:"Quickstart",id:"quickstart",children:[{value:"Dependencies",id:"dependencies",children:[]},{value:"Basic Usage",id:"basic-usage",children:[]}]},{value:"Customizing what\u2019s Persisted",id:"customizing-whats-persisted",children:[]},{value:"The Merge Process",id:"the-merge-process",children:[]},{value:"Nested Persists",id:"nested-persists",children:[]},{value:"API Reference",id:"api-reference",children:[]}],u={toc:l};function p(e){var t=e.components,r=Object(a.a)(e,["components"]);return Object(s.b)("wrapper",Object(n.a)({},u,r,{components:t,mdxType:"MDXLayout"}),Object(s.b)("p",null,"Redux Persist takes your Redux state object and saves it to persisted storage. Then on app launch it retrieves this persisted state and saves it back to redux."),Object(s.b)("h2",{id:"quickstart"},"Quickstart"),Object(s.b)("p",null,"Persist and rehydrate a redux store."),Object(s.b)("h3",{id:"dependencies"},"Dependencies"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-bash"},"npm install --save redux-persist\n\n- OR -\n\nyarn add redux-persist\n")),Object(s.b)("h3",{id:"basic-usage"},"Basic Usage"),Object(s.b)("p",null,"When creating your redux store, pass your createStore function a ",Object(s.b)("a",{parentName:"p",href:"#persistreducerconfig-reducer"},"persistReducer")," that wraps your app\u2019s root reducer. Once your store is created, pass it to the ",Object(s.b)("a",{parentName:"p",href:"#persiststorestore-config-callback"},"persistStore")," function, which ensures your redux state is saved to persisted storage whenever it changes."),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-js"},"// configureStore.js\n\nimport {createStore} from 'redux';\nimport {persistStore, persistReducer} from 'redux-persist';\nimport storage from 'redux-persist/lib/storage'; // defaults to localStorage for web\n\nimport rootReducer from './reducers';\n\nconst persistConfig = {\n  key: 'root',\n  storage,\n};\n\nconst persistedReducer = persistReducer(persistConfig, rootReducer);\n\nexport default () => {\n  let store = createStore(persistedReducer);\n  let persistor = persistStore(store);\n  return {store, persistor};\n};\n")),Object(s.b)("p",null,"If you are using React, wrap your root component with PersistGate. This delays the rendering of your app\u2019s UI until your persisted state has been retrieved and saved to redux."),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-jsx"},"import {PersistGate} from 'redux-persist/integration/react';\n\n// ... normal setup, create store and persistor, import components etc.\n\nconst App = () => {\n  return (\n    <Provider store={store}>\n      <PersistGate loading={null} persistor={persistor}>\n        <RootComponent />\n      </PersistGate>\n    </Provider>\n  );\n};\n")),Object(s.b)("h2",{id:"customizing-whats-persisted"},"Customizing what\u2019s Persisted"),Object(s.b)("p",null,"If you don\u2019t want to persist a part of your state you could put it in the blacklist. The blacklist is added into the config object that we used when setting up our PersistReducer."),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-js"},"const persistConfig = {\n  key: 'root',\n  storage: storage,\n  blacklist: ['navigation'],\n};\n\nconst pReducer = persistReducer(persistConfig, rootReducer);\n\nexport const store = createStore(pReducer);\nexport const persistor = persistStore(store);\n")),Object(s.b)("p",null,"If you want to persist only few parts of your state, you could set up them in whitelist."),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-js"},"const persistConfig = {\n  key: 'root',\n  storage: storage,\n  whitelist: ['auth'], // only auth will be persisted\n};\n\nconst pReducer = persistReducer(persistConfig, rootReducer);\n\nexport const store = createStore(pReducer);\nexport const persistor = persistStore(store);\n")),Object(s.b)("h2",{id:"the-merge-process"},"The Merge Process"),Object(s.b)("p",null,"When your app launches, redux sets an initial state. Shortly after this, Redux Persist retrieves your persisted state from storage. Your persisted state then overrides any initial state. The merge process is meant to \u201cjust work\u201d automatically for you. However, you can also take manual control of the process. For example, in older versions of Redux Persist it was common to manage the rehydration process by catching the REHYDRATE action in your reducers and then saving the action\u2019s payload to your redux state."),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-js"},"import { REHYDRATE } from 'redux-persist';\n\nconst INITIAL_STATE = {\n  currentUser: null,\n  isLoggingIn: false\n};\n\nconst AuthReducer = (state = INITIAL_STATE, action) => {\n  switch (action.type) {\n\n    case REHYDRATE:\n      return {\n        ...state,\n        currentUser: action.payload.currentUser\n      };\n\n    // ...handle other cases\n")),Object(s.b)("p",null,"The REHYDRATE action is dispatched by Redux Persist immediately after your persisted state is obtained from storage. If you return a new state object from the REHYDRATE action, this will be your finalized state. As mentioned though, you don\u2019t need to do this anymore unless you need to customize the way your state is rehydrated."),Object(s.b)("h2",{id:"nested-persists"},"Nested Persists"),Object(s.b)("p",null,"Nested persist can be useful for including different storage adapters, code splitting, or deep filtering. For example while blacklist and whitelist only work one level deep, but we can use a nested persist to blacklist a deeper value:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-js"},"import {combineReducers} from 'redux';\nimport {persistReducer} from 'redux-persist';\nimport storage from 'redux-persist/lib/storage';\n\nimport {authReducer, otherReducer} from './reducers';\n\nconst rootPersistConfig = {\n  key: 'root',\n  storage: storage,\n  blacklist: ['auth'],\n};\n\nconst authPersistConfig = {\n  key: 'auth',\n  storage: storage,\n  blacklist: ['somethingTemporary'],\n};\n\nconst rootReducer = combineReducers({\n  auth: persistReducer(authPersistConfig, authReducer),\n  other: otherReducer,\n});\n\nexport default persistReducer(rootPersistConfig, rootReducer);\n")),Object(s.b)("h2",{id:"api-reference"},"API Reference"),Object(s.b)("h4",{id:"persistreducerconfig-reducer"},Object(s.b)("inlineCode",{parentName:"h4"},"persistReducer(config, reducer)")),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"arguments",Object(s.b)("ul",{parentName:"li"},Object(s.b)("li",{parentName:"ul"},Object(s.b)("a",{parentName:"li",href:"https://github.com/rt2zz/redux-persist/blob/master/src/types.js#L13-L27"},Object(s.b)("strong",{parentName:"a"},"config"))," ",Object(s.b)("em",{parentName:"li"},"object"),Object(s.b)("ul",{parentName:"li"},Object(s.b)("li",{parentName:"ul"},"required config: ",Object(s.b)("inlineCode",{parentName:"li"},"key, storage")),Object(s.b)("li",{parentName:"ul"},"notable other config: ",Object(s.b)("inlineCode",{parentName:"li"},"whitelist, blacklist, version, stateReconciler, debug")))),Object(s.b)("li",{parentName:"ul"},Object(s.b)("strong",{parentName:"li"},"reducer")," ",Object(s.b)("em",{parentName:"li"},"function"),Object(s.b)("ul",{parentName:"li"},Object(s.b)("li",{parentName:"ul"},"any reducer will work, typically this would be the top level reducer returned by ",Object(s.b)("inlineCode",{parentName:"li"},"combineReducers")))))),Object(s.b)("li",{parentName:"ul"},"returns an enhanced reducer")),Object(s.b)("h4",{id:"persiststorestore-config-callback"},Object(s.b)("inlineCode",{parentName:"h4"},"persistStore(store, [config, callback])")),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"arguments",Object(s.b)("ul",{parentName:"li"},Object(s.b)("li",{parentName:"ul"},Object(s.b)("strong",{parentName:"li"},"store")," ",Object(s.b)("em",{parentName:"li"},"redux store")," The store to be persisted."),Object(s.b)("li",{parentName:"ul"},Object(s.b)("strong",{parentName:"li"},"config")," ",Object(s.b)("em",{parentName:"li"},"object")," (typically null)",Object(s.b)("ul",{parentName:"li"},Object(s.b)("li",{parentName:"ul"},"If you want to avoid that the persistence starts immediately after calling ",Object(s.b)("inlineCode",{parentName:"li"},"persistStore"),", set the option manualPersist. Example: ",Object(s.b)("inlineCode",{parentName:"li"},"{ manualPersist: true }")," Persistence can then be started at any point with ",Object(s.b)("inlineCode",{parentName:"li"},"peristor.persist()"),". You usually want to do this if your storage is not ready when the ",Object(s.b)("inlineCode",{parentName:"li"},"persistStore")," call is made."))),Object(s.b)("li",{parentName:"ul"},Object(s.b)("strong",{parentName:"li"},"callback")," ",Object(s.b)("em",{parentName:"li"},"function")," will be called after rehydration is finished."))),Object(s.b)("li",{parentName:"ul"},"returns ",Object(s.b)("strong",{parentName:"li"},"persistor")," object")),Object(s.b)("h4",{id:"persistor-object"},Object(s.b)("inlineCode",{parentName:"h4"},"persistor object")),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"the persistor object is returned by persistStore with the following methods:",Object(s.b)("ul",{parentName:"li"},Object(s.b)("li",{parentName:"ul"},Object(s.b)("inlineCode",{parentName:"li"},".purge()"),Object(s.b)("ul",{parentName:"li"},Object(s.b)("li",{parentName:"ul"},"purges state from disk and returns a promise"))),Object(s.b)("li",{parentName:"ul"},Object(s.b)("inlineCode",{parentName:"li"},".flush()"),Object(s.b)("ul",{parentName:"li"},Object(s.b)("li",{parentName:"ul"},"immediately writes all pending state to disk and returns a promise"))),Object(s.b)("li",{parentName:"ul"},Object(s.b)("inlineCode",{parentName:"li"},".pause()"),Object(s.b)("ul",{parentName:"li"},Object(s.b)("li",{parentName:"ul"},"pauses persistence"))),Object(s.b)("li",{parentName:"ul"},Object(s.b)("inlineCode",{parentName:"li"},".persist()"),Object(s.b)("ul",{parentName:"li"},Object(s.b)("li",{parentName:"ul"},"resumes persistence")))))),Object(s.b)(i.a,{name:"Tessy Thomas",date:"07/05/2020",mdxType:"EditedBy"}))}p.isMDXComponent=!0},158:function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return m}));var n=r(0),a=r.n(n);function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=a.a.createContext({}),u=function(e){var t=a.a.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},p=function(e){var t=u(e.components);return a.a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},b=a.a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,s=e.originalType,i=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),p=u(r),b=n,m=p["".concat(i,".").concat(b)]||p[b]||d[b]||s;return r?a.a.createElement(m,o(o({ref:t},l),{},{components:r})):a.a.createElement(m,o({ref:t},l))}));function m(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var s=r.length,i=new Array(s);i[0]=b;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o.mdxType="string"==typeof e?e:n,i[1]=o;for(var l=2;l<s;l++)i[l]=r[l];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,r)}b.displayName="MDXCreateElement"},159:function(e,t,r){"use strict";var n=r(0),a=r.n(n),s=r(1),i=r.n(s),o=r(56),c=r.n(o),l={name:i.a.string.isRequired,updated:i.a.string,date:i.a.string.isRequired},u=function(e){var t=e.name,r=e.updated,n=e.date;return a.a.createElement("div",{className:c.a.editedBy},a.a.createElement("div",{className:c.a.block+" "+(n?"":c.a.single)},a.a.createElement("span",{className:c.a.label},"Author"),a.a.createElement("span",{className:c.a.value},t)),r?a.a.createElement("div",{className:c.a.block+" "+(n?c.a.double:"")},a.a.createElement("span",{className:c.a.label},"Updated by"),a.a.createElement("span",{className:c.a.value},r)):null,a.a.createElement("div",{className:c.a.block+" "+(n?c.a.double:"")},a.a.createElement("span",{className:c.a.label},"On"),a.a.createElement("span",{className:c.a.value},n)))};u.propTypes=l,u.defaultProps={updated:""},t.a=u}}]);